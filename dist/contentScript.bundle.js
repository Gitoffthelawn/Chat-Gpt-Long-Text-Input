(()=>{"use strict";var e,t={255:(e,t,n)=>{n.d(t,{Z:()=>i});const i=function(e,t,n=!1){let i=n?/(\r\n|\r|\n)/:/(?<=\S)(?=\s|$)/,a=e.split(i),o=[],r="";for(let e of a){let i=n?e.length:e.length+(r.length>0?1:0);r.length+i<=t?r+=(n||0===r.length?"":" ")+e:(r.length>0&&o.push(r),r=e)}return r.length&&o.push(r),o}}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=i(255),async function(){if(window.hasRun)return;window.hasRun=!0;let t=window.location.href,n=!1,i=[],a=0;var o,r,l,s,d=0,c=0,m=0;async function g(t){let i=(0,e.Z)(t.textToImport,t.maxMessageLength,t.splitOnLineBreaks);for(var a=0;a<i.length;a++){var o=i[a],r=t.messagePrepend+"\n\n"+o+"\n\n"+t.messageAppend;if(n)break;await y(p,r),await u(s)}}function u(e){return new Promise((t=>setTimeout(t,e)))}async function p(e){if(void 0===document.getElementsByTagName("textarea")[0])return void console.log("failure");document.body.getElementsByTagName("textarea")[0].value=e;let t=new Event("input",{bubbles:!0,cancelable:!0});document.body.getElementsByTagName("textarea")[0].dispatchEvent(t),document.body.getElementsByTagName("textarea")[0].dispatchEvent(w),c++;let n=(new Date).getTime();if(0!==a){i.push(n-a);let e=i.reduce(((e,t)=>e+t))/i.length*(d-c)/1e3,t=Math.floor(e/60);e%=60,document.getElementById("messages-remaining-display").textContent=d!==c?`${c}/${d} ETA: ${t}m ${Math.round(e)}s`:`${c}/${d}`}else document.getElementById("messages-remaining-display").textContent=`${c}/${d} ETA: Calculating...`;a=n}function h(t,n=!1){let i=(0,e.Z)(t.textToImport,t.maxMessageLength,t.splitOnLineBreaks).length;return n||i++,"true"===t.useFinalPrompt.toLowerCase()&&i++,i}function f(e){const t=e.getBoundingClientRect(),n=getComputedStyle(e);return"none"!==n.display&&"hidden"!==n.visibility&&t.width>0&&t.height>0&&t.bottom>=0&&t.right>=0&&t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.left<=(window.innerWidth||document.documentElement.clientWidth)}async function y(e,t){let i=!1;for(;!i&&!n;){let n=document.querySelectorAll("button");for(let e=0;e<n.length;e++)if(n[e].className.includes("p-1 gizmo:pl-0 rounded-md disabled:dark:hover:text-gray-400")&&f(n[e])&&document.querySelectorAll('button[aria-label="Stop generating"]').length<1){i=!0;break}i?(await u(l),await e(t)):await u(r)}}!async function(){const e=await fetch(browser.runtime.getURL("config.json"));o=await e.json(),l=o.readyDelayTimeout,r=o.checkReadyButtonTimeout,s=o.timeBetweenMessages}();const w=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0,cancelable:!0,isTrusted:!0});browser.runtime.onMessage.addListener((e=>{var r=document.getElementById("prompt-textarea").parentNode.parentNode;if("run"===e.command){if((l=document.createElement("span")).id="messages-remaining-display",l.textContent="",l.style.display="flex",l.style.alignItems="center",l.style.marginInline="10px",r.hasChildNodes()){for(let e=0;e<r.childNodes.length;e++)"messages-remaining-display"===r.childNodes[e].id&&r.removeChild(r.childNodes[e]);"File-Picker-Button"!==r.firstChild.id&&"messages-remaining-display"!==r.firstChild.id?r.insertBefore(l,r.firstChild):"File-Picker-Button"===r.firstChild.id&&r.insertBefore(l,r.firstChild.nextSibling)}else r.appendChild(l);n=!1,async function(e){t.match("https://chat.openai.com/?.*")?(m=h(e),d=m,c=0,i=[],a=0,await p(e.mainPrompt),await u(s),await y(g,e),"true"===e.useFinalPrompt.toLowerCase()&&(await u(s),n||await y(p,e.finalPrompt))):console.log("Wrong Url")}(e)}else if("resume"===e.command){var l;(l=document.createElement("span")).id="messages-remaining-display",l.textContent="",l.style.display="flex",l.style.alignItems="center",l.style.marginLeft="10px",r.hasChildNodes()?"File-Picker-Button"!==r.firstChild.id&&"messages-remaining-display"!==r.firstChild.id?r.insertBefore(l,r.firstChild):"File-Picker-Button"===r.firstChild.id&&r.insertBefore(l,r.firstChild.nextSibling):r.appendChild(l),n=!1,async function(e){t.match("https://chat.openai.com/?.*")?(m=h(e,!0),d=m,c=0,i=[],a=0,await y(g,e),"true"===e.useFinalPrompt.toLowerCase()&&(await u(s),await y(p,e.finalPrompt))):console.log("Wrong Url")}(e)}else if("file-get"===e.command)if("true"===localStorage.getItem("importFile-new")){const e=localStorage.getItem("importFile");browser.runtime.sendMessage({command:"file-get",content:e}),localStorage.setItem("importFile-new","false")}else browser.runtime.sendMessage({command:"file-get",content:""});else if("stop"===e.command)n=!0;else if("file-pick"===e.command){document.getElementById("prompt-textarea");var f=null;(f=document.createElement("input")).style="display: none;",f.id="filepicker-input",f.type="file",f.accept=".txt",f.onchange=e=>{localStorage.setItem("importFile-new","true");var t=e.target.files[0],n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=e=>{var t=e.target.result;localStorage.setItem("importFile",t)}},document.body.appendChild(f);var w=document.createElement("button");w.classList.add(...o.regenerateResponseButtonClassString.split(" "));const e=browser.runtime.getURL("/icons/Red32.png");w.id="File-Picker-Button",w.style.backgroundImage=`url("${e}")`,w.style.backgroundSize="contain",w.style.backgroundRepeat="no-repeat",w.style.backgroundPosition="center",w.style.backgroundColor="transparent",w.style.border="none",w.style.height="32px",w.style.width="32px",w.style.alignSelf="center",w.style.marginInline="10px",r.hasChildNodes()?"File-Picker-Button"!==r.firstChild.id&&r.insertBefore(w,r.firstChild):r.appendChild(w),w.onclick=()=>{f.click()}}}))}()})();