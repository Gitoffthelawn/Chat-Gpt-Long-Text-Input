(()=>{"use strict";var e={255:(e,t,n)=>{n.d(t,{Z:()=>a});const a=function(e,t,n=!1){let a=n?/(\r\n|\r|\n)/:/(?<=\S)(?=\s|$)/,o=e.split(a),l=[],s="";for(let e of o){let a=n?e.length:e.length+(s.length>0?1:0);s.length+a<=t?s+=(n||0===s.length?"":" ")+e:(s.length>0&&l.push(s),s=e)}return s.length&&l.push(s),l}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,n),l.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(255),t={},a={},o=0;function l(){o=function(t,n,a){let o=(0,e.Z)(t,n,"true"===localStorage.getItem("defaultSplitOnLineBreaks")).length;return o++,"true"===a.toLowerCase()&&o++,o}(document.getElementById("textInput").value,localStorage.getItem("defaultMaxMessageLength"),localStorage.getItem("defaultUseFinalPrompt")),document.getElementById("messageCount").textContent=o.toString()+" Total messages"}async function s(){const e=await fetch(browser.runtime.getURL("config.json")),n=await e.json();a={textToImport:"",mainPrompt:(t=n).mainPrompt,messagePrepend:t.messagePrepend,messageAppend:t.messageAppend,maxMessageLength:t.maxMessageLength,useFinalPrompt:t.useFinalPrompt,finalPrompt:t.finalPrompt,splitOnLineBreaks:t.splitOnLineBreaks},localStorage.setItem("defaultMainPrompt",a.mainPrompt),localStorage.setItem("defaultMessagePrepend",a.messagePrepend),localStorage.setItem("defaultMessageAppend",a.messageAppend),localStorage.setItem("defaultMaxMessageLength",a.maxMessageLength),localStorage.setItem("defaultUseFinalPrompt",a.useFinalPrompt),localStorage.setItem("defaultFinalPrompt",a.finalPrompt),localStorage.setItem("defaultSplitOnLineBreaks",a.splitOnLineBreaks)}!async function(){localStorage.getItem("defaultMainPrompt")&&localStorage.getItem("defaultMessagePrepend")&&localStorage.getItem("defaultMessageAppend")&&localStorage.getItem("defaultMaxMessageLength")&&localStorage.getItem("defaultFinalPrompt")?a={textToImport:"",mainPrompt:localStorage.getItem("defaultMainPrompt"),messagePrepend:localStorage.getItem("defaultMessagePrepend"),messageAppend:localStorage.getItem("defaultMessageAppend"),maxMessageLength:localStorage.getItem("defaultMaxMessageLength"),useFinalPrompt:localStorage.getItem("defaultUseFinalPrompt"),finalPrompt:localStorage.getItem("defaultFinalPrompt"),splitOnLineBreaks:localStorage.getItem("defaultSplitOnLineBreaks")}:await s(),m()}(),document.getElementById("settings-button");const d=document.getElementById("settings-content");function m(){"true"===localStorage.getItem("defaultUseFinalPrompt")?document.getElementById("FinalPromptDiv").style.display="block":document.getElementById("FinalPromptDiv").style.display="none"}function r(e){browser.tabs.sendMessage(e[0].id,{command:"stop"}).catch(u)}document.getElementById("popup-content"),window.addEventListener("visibilitychange",(e=>{var t={textToImport:document.getElementById("textInput").value,mainPrompt:document.getElementById("mainPrompt").value,messagePrepend:document.getElementById("messagePrepend").value,messageAppend:document.getElementById("messageAppend").value,finalPrompt:document.getElementById("finalPrompt").value};localStorage.setItem("popupData",JSON.stringify(t))})),document.getElementById("textInput").addEventListener("input",l);var i=JSON.parse(localStorage.getItem("popupData"));function u(e){}null!==i&&(document.getElementById("textInput").value=i.textToImport,document.getElementById("mainPrompt").value=i.mainPrompt,document.getElementById("messagePrepend").value=i.messagePrepend,document.getElementById("messageAppend").value=i.messageAppend,document.getElementById("finalPrompt").value=i.finalPrompt),browser.runtime.onMessage.addListener((e=>{if("file-get"===e.command){const t=e.content;""!==t&&(document.getElementById("textInput").value=t)}})),browser.tabs.query({active:!0,currentWindow:!0}).then((function(e){try{browser.tabs.executeScript(e[0].id,{file:"/contentScript.bundle.js"}),browser.tabs.sendMessage(e[0].id,{command:"file-get"}).catch(u)}catch(e){}})),document.addEventListener("click",(e=>{"BUTTON"===e.target.tagName&&null===document.querySelector(".confirmation-popup")&&(e.target.closest("#popup-content")||e.target.closest("#settings-content"))&&("settings-button"===e.target.id?(d.classList.toggle("show"),document.getElementById("defaultMainPrompt").value=a.mainPrompt,document.getElementById("defaultPrepend").value=a.messagePrepend,document.getElementById("defaultAppend").value=a.messageAppend,document.getElementById("defaultMaxMessageLength").value=a.maxMessageLength,document.getElementById("defaultUseFinalPrompt").checked="true"===a.useFinalPrompt,document.getElementById("defaultFinalPrompt").value=a.finalPrompt,document.getElementById("defaultSplitOnLineBreaks").checked="true"===a.splitOnLineBreaks):"close-button"===e.target.id?d.classList.toggle("show"):"file-button"===e.target.id?browser.tabs.query({currentWindow:!0,active:!0}).then((e=>{browser.tabs.sendMessage(e[0].id,{command:"file-pick"}).catch((e=>{new Promise(((e,t)=>{const n=document.createElement("div");n.classList.add("confirmation-popup");const a=document.createElement("p");a.classList.add("confirmation-text"),a.textContent="Error. Make sure you are on the right web page.",n.appendChild(a);const o=document.createElement("button");o.textContent="Okay",o.classList.add("centered-button"),o.addEventListener("click",(()=>{n.remove(),e()})),n.appendChild(o),document.body.appendChild(n);const l=n.offsetWidth,s=n.offsetHeight,d=window.innerWidth,m=window.innerHeight;n.style.left=(d-l)/2+"px",n.style.top=(m-s)/2+"px"}))}))})).catch((e=>{})):"save-button"===e.target.id?(d.classList.toggle("show"),a.mainPrompt=document.getElementById("defaultMainPrompt").value,a.messagePrepend=document.getElementById("defaultPrepend").value,a.messageAppend=document.getElementById("defaultAppend").value,a.maxMessageLength=document.getElementById("defaultMaxMessageLength").value,a.useFinalPrompt=document.getElementById("defaultUseFinalPrompt").checked.toString(),a.finalPrompt=document.getElementById("defaultFinalPrompt").value,a.splitOnLineBreaks=document.getElementById("defaultSplitOnLineBreaks").checked.toString(),localStorage.setItem("defaultMainPrompt",a.mainPrompt),localStorage.setItem("defaultMessagePrepend",a.messagePrepend),localStorage.setItem("defaultMessageAppend",a.messageAppend),localStorage.setItem("defaultMaxMessageLength",a.maxMessageLength),localStorage.setItem("defaultUseFinalPrompt",a.useFinalPrompt),localStorage.setItem("defaultFinalPrompt",a.finalPrompt),localStorage.setItem("defaultSplitOnLineBreaks",a.splitOnLineBreaks),m(),l()):"hard-reset-button"===e.target.id?new Promise(((e,t)=>{const n=document.createElement("div");n.classList.add("confirmation-popup");const a=document.createElement("p");a.classList.add("confirmation-text"),a.textContent="Are you sure you want to restore the original default values?",n.appendChild(a);const o=document.createElement("button");o.textContent="Yes",o.addEventListener("click",(()=>{n.remove(),e("yes")})),n.appendChild(o);const l=document.createElement("button");l.textContent="No",l.addEventListener("click",(()=>{n.remove(),e("no")})),n.appendChild(l),document.body.appendChild(n);const s=n.offsetWidth,d=n.offsetHeight,m=window.innerWidth,r=window.innerHeight;n.style.left=(m-s)/2+"px",n.style.top=(r-d)/2+"px"})).then((e=>{"yes"===e&&s().then((()=>{document.getElementById("defaultMainPrompt").value=a.mainPrompt,document.getElementById("defaultPrepend").value=a.messagePrepend,document.getElementById("defaultAppend").value=a.messageAppend,document.getElementById("defaultUseFinalPrompt").checked="true"===a.useFinalPrompt,document.getElementById("defaultFinalPrompt").value=a.finalPrompt,document.getElementById("defaultMaxMessageLength").value=a.maxMessageLength,document.getElementById("defaultSplitOnLineBreaks").checked="true"===a.splitOnLineBreaks,d.classList.toggle("show"),l()}))})).catch((e=>{console.error(e)})):"reset-button"===e.target.id?(document.getElementById("textInput").value=a.textToImport,document.getElementById("mainPrompt").value=a.mainPrompt,document.getElementById("messagePrepend").value=a.messagePrepend,document.getElementById("messageAppend").value=a.messageAppend,document.getElementById("finalPrompt").value=a.finalPrompt,l()):"stop-button"===e.target.id?browser.tabs.query({active:!0,currentWindow:!0}).then(r).catch(u):"start-button"===e.target.id?browser.tabs.query({active:!0,currentWindow:!0}).then((function(e){browser.tabs.sendMessage(e[0].id,{command:"run",maxMessageLength:localStorage.getItem("defaultMaxMessageLength"),textToImport:document.getElementById("textInput").value,mainPrompt:document.getElementById("mainPrompt").value,messagePrepend:document.getElementById("messagePrepend").value,messageAppend:document.getElementById("messageAppend").value,useFinalPrompt:localStorage.getItem("defaultUseFinalPrompt"),finalPrompt:document.getElementById("finalPrompt").value,splitOnLineBreaks:localStorage.getItem("defaultSplitOnLineBreaks")})})).catch(u):"resume-button"===e.target.id&&new Promise(((e,t)=>{const n=document.createElement("div");n.classList.add("confirmation-popup");const a=document.createElement("label");a.textContent="Paste in a unique string that you want to resume from.",a.style.display="block",a.style.margin="10px",n.appendChild(a);const o=document.createElement("textarea");o.style.width="75%",o.style.height="100px",o.style.resize="none",o.style.margin="20px",n.appendChild(o);const l=document.createElement("button");l.textContent="Cancel",l.id="cancel-button",l.style.marginRight="10px",l.addEventListener("click",(()=>{document.body.removeChild(n)})),n.appendChild(l);const s=document.createElement("button");s.textContent="Submit",s.id="submit-button",s.addEventListener("click",(t=>{"submit-button"===t.target.id?e(o.value):"cancel-button"===t.target.id&&e(null),o.value,n.remove()})),n.appendChild(s),document.body.appendChild(n);const d=n.offsetWidth,m=n.offsetHeight,r=window.innerWidth,i=window.innerHeight;n.style.left=(r-d)/2+"px",n.style.top=(i-m)/2+"px"})).then((e=>{null!==e&&browser.tabs.query({active:!0,currentWindow:!0}).then((t=>{!function(e,t){const n=document.getElementById("textInput").value,a=n.indexOf(t);if(-1===a)return void console.error("Starting string not found in text input.");const o=n.substring(a);browser.tabs.sendMessage(e[0].id,{command:"resume",maxMessageLength:localStorage.getItem("defaultMaxMessageLength"),textToImport:o,messagePrepend:document.getElementById("messagePrepend").value,messageAppend:document.getElementById("messageAppend").value,useFinalPrompt:localStorage.getItem("defaultUseFinalPrompt"),finalPrompt:document.getElementById("finalPrompt").value,splitOnLineBreaks:localStorage.getItem("defaultSplitOnLineBreaks")})}(t,e)})).catch(u)})))})),l()})()})();